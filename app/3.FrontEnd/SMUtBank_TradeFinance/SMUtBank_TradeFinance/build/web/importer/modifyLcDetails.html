<!DOCTYPE html>
<html lang="en" class="app">

    <head>
        <meta charset="utf-8" />
        <title>SMU tBank - Trade Finance Application</title>

        <meta name="description" content="app, web app, responsive, admin dashboard, admin, flat, flat ui, ui kit, off screen nav" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <link rel="stylesheet" href="../assets/css/bootstrap.css" type="text/css" />
        <link rel="stylesheet" href="../assets/css/animate.css" type="text/css" />
        <link rel="stylesheet" href="../assets/css/font-awesome.min.css" type="text/css" />
        <link rel="stylesheet" href="../assets/css/font.css" type="text/css" />
        <link rel="stylesheet" href="../assets/js/calendar/bootstrap_calendar.css" type="text/css" />
        <link rel="stylesheet" href="../assets/js/jvectormap/jquery-jvectormap-1.2.2.css" type="text/css" />
        <link rel="stylesheet" href="../assets/css/app.css" type="text/css" />
        <link rel="stylesheet" href="../assets/js/select2/select2.css" type="text/css" />
        <link rel="stylesheet" href="../assets/js/select2/theme.css" type="text/css" />
        <!--[if lt IE 9]>
        <script src="../assets/js/ie/html5shiv.js"></script>
        <script src="../assets/js/ie/respond.min.js"></script>
        <script src="../assets/js/ie/excanvas.js"></script>
      <![endif]-->
        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>

        <script>
            function capitalizeFirstLetter(word) {
            return word.charAt(0).toUpperCase() + word.slice(1)
        };
            $(function () {
                $("#header").load("header.html");
                $("#nav-bar").load("navBar.html");
            });

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] === variable) {
                return pair[1];
            }
        }
        alert('Query Variable ' + variable + ' not found');
    }

    var refNum = getQueryVariable("refNum");
    var ref2 = "0000001010";
    var LC_ID = "";
    var exporter_ID = "";
    var exporter_account_num = "";

    var goods_description = "";
    var amount = "";
    var expiry_date = "";
    var additional_conditions = "";
    var original = null;
    var amendments = null;
        if (refNum !== "") {
            var apiURL = 'http://smu.tbankonline.com/SMUtBank_API/Gateway';
            // var testURL = 'http://smu.tbankonline.com/SMUtBank_API/Gateway?Header={"Header":{"PIN":"123456","OTP":"999999","serviceName":"getLetterOfCreditRefNumList","userID":"kinetic1"}}&ConsumerID=TF';
            // var role = document.getElementByID("role").value;

            var headerObj = {
                Header: {
                    serviceName: "getLetterOfCredit",
                    userID: "kinetic1",
                    PIN: "123456",
                    OTP: "999999"
                }
            };
            var header = JSON.stringify(headerObj);

            var contentObj = {
                Content: {
                    referenceNumber: refNum, // to change to variable refNum
                    mode: "BC"
                }
            };
            var content = JSON.stringify(contentObj);

            if (true) {

                var xmlHttp = new XMLHttpRequest();              //setup new http req
                if (xmlHttp === null) {
                    alert("Browser does not support HTTP request."); //check for browser thingy
                }

                xmlHttp.open("POST", apiURL + "?Header=" + header + "&Content=" + content + "&ConsumerID=TF", true);
                // xmlHttp.open("POST", testURL, true);
                // console.log(apiURL+"?Header="+header+"&Content="+content+"&ConsumerID=TF");
                xmlHttp.timeout = 5000;

                // setup http event handlers
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState === 4 && xmlHttp.status === 200) {
                        // console.log(xmlHttp.responseText);
                        responseObj = JSON.parse(xmlHttp.responseText);
                        // globalErrorID = responseObj.Content.ServiceRespHeader.GlobalErrorID;
                        //when the gateway is ready 
                        // console.log(JSON.stringify(responseObj.Content.ServiceResponse.LC_Details.LC_record.LC_ID) );
                        if (true) {
                            fields = responseObj.Content.ServiceResponse.LC_Details.LC_record;
                            
                            var headerVariables = ["ref_num","status","creation_datetime"];
                            var refNum = fields[headerVariables[0]];
                            var status = fields[headerVariables[1]];
                            var dateSubmitted = fields[headerVariables[2]];
                            $('#refNum').html(refNum);
                            $('#status').html(status);
                            $('#dateSubmitted').html(dateSubmitted);
                            
                            original = fields;
                            for (var i in original) {
                                
                                var isCounted = false;
                                for (var j in headerVariables){

                                    if (i === headerVariables[j]){
                                        isCounted = true;
                                    }
                                }
                                if(!isCounted){
                                    var lcDetailsHTML = "<label class='col-lg-2 control-label lc-label'>" + i + "</label>";
                                    lcDetailsHTML += "<div class='col-lg-10 font-bold'><p id='" + i + "'></p>";
                                    lcDetailsHTML += "</div><input id='input' type='text' name ="+i+" data-required='true' placeholder='"+original[i]+"'>";
                                    //compare 2 json objects, if any of the values is different, highlight the different values 
                                    if (amendments !== original.i) {
                                 //var getInputElement = document.getElementsByClassName("input");
                                 //var color = $(getInputElement).css( "background-color", "yellow" ); 
                                        $("input[type='text']").css( "background-color", "#fb6b5b" );

                                    } 
                                    $("label").css( "vertical-align", "center" );

                                    $("#lcDetails").append("<div class='form-group lc-form'>" + lcDetailsHTML + "</div>");
                                    $("#lcDetails").append("<div class='line line-dashed line-lg pull-in'></div>");

                                }
                                /*var lcDetailsHTML = "<label class='col-sm-2 control-label'>"+i+"</label>";
                                 lcDetailsHTML += "<div class='col-sm-10'><p id='"+i+"'></p>";
                                 lcDetailsHTML += "</div><input id='input' type='text' name ="+i+" data-required='true' placeholder='"+original[i]+"'>";
                                 //compare 2 json objects, if any of the values is different, highlight the different values 
                                 if (amendments !== original.i) {
                                 //var getInputElement = document.getElementsByClassName("input");
                                 //var color = $(getInputElement).css( "background-color", "yellow" ); 
                                 $("input[type='text']").css( "background-color", "#fb6b5b" );
                                
                                 } 
                                 $("label").css( "vertical-align", "center" );
                                 $( "#lcDetails" ).append( "<div class='form-group'>"+lcDetailsHTML+"</div>" ); 
                                 $( "#lcDetails" ).append( "<div class='line line-dashed line-lg pull-in'></div>" );*/


                            }
                            /*exporter_ID = responseObj.Content.ServiceResponse.LC_Details.LC_record.exporter_ID;
                             exporter_account_num = responseObj.Content.ServiceResponse.LC_Details.LC_record.exporter_account_num;
                             goods_description = responseObj.Content.ServiceResponse.LC_Details.LC_record.goods_description;
                             amount = responseObj.Content.ServiceResponse.LC_Details.LC_record.amount;
                             expiry_date = responseObj.Content.ServiceResponse.LC_Details.LC_record.expiry_date;
                             additional_conditions = responseObj.Content.ServiceResponse.LC_Details.LC_record.additional_conditions;

                             $('#exporter_ID').html(exporter_ID);
                             $('#exporter_account_num').html(exporter_account_num);
                             $('#goods_description').html(goods_description);
                             $('#expiry_date').html(expiry_date);
                             $('#additional_conditions').html(additional_conditions);
                             $('#amount').html(amount);*/
                        } else {

                        }

                    }
                };
                xmlHttp.ontimeout = function (e) {
                    alert("Timeout retrieving document type list.");
                    callback();
                };

                xmlHttp.send();

            }
        }
     
 
        

           /* for (var field = 0; field < comparison[0].length - 1; field++) {
             var lcDetailsHTML = "<label class='col-sm-2 control-label'>"+i+"</label>";
             lcDetailsHTML += "<div class='col-sm-10'><p id='"+field+"'></p>";
             lcDetailsHTML += "</div><input type='text' name ="+field+" data-required='true' placeholder='"+comparison[0][i]+"'>";
             //compare 2 json objects, if any of the values is different, highlight the different values 
             if (comparison[1][i] !== comparison[0][i]) {
             var getInputElement = lcDetailsHTML.getElementsByTagName("input");
             var color = $(getInputElement).css( "background-color", "yellow" );     
             }   
             $( "#lcDetails" ).append( "<div class='form-group'>"+lcDetailsHTML+"</div>" ); 
             $( "#lcDetails" ).append( "<div class='line line-dashed line-lg pull-in'></div>" );
             
             }
             var buttons = "<div class='form-group'><div class='col-sm-4 col-sm-offset-2'><a href='importer.html'><button type='submit' class='btn btn-primary'>Back</button></a></div>";
             buttons += "<div class='col-sm-4 col-sm-offset-2'><button id='modifyLcBtn' type='submit' class='btn btn-primary'>Submit</button></div></div>";
             
             $( "#lcDetails" ).append(buttons);*/
          

        </script>


    </head>

    <body class="">

        <section class="vbox">
            <!--Header-->
            <header class="bg-black dk header navbar navbar-fixed-top-xs" id="header">
            </header>
            <!--End of Header-->
            <section>
                <section class="hbox stretch">
                    <!-- .aside -->
                    <aside class="bg-dark lter aside-md hidden-print hidden-xs" id="nav-bar">

                    </aside>
                    <!-- /.aside -->
                    <!--Content-->
                    <section id="content">
                        <section class="vbox">
                            <section class="scrollable">
                                <div class="wrapper-lg">
                                    <h2 class="m-b-xs font-bold m-t-none">LC Modification</h2>
                                </div>

                                <section class="panel panel-default">
                                    <header class="panel-heading font-bold">
                                        <div class="bs-example form-horizontal">
                                            <div class="form-group lc-form">
                                                    <label class="col-sm-2 control-label lc-label">Ref Num </label>
                                                    <div class="col-sm-2 lc-value">
                                                        <p id="refNum"></p>
                                                    </div>
                                                     <label class="col-sm-2 control-label">Status </label>
                                                    <div class="col-sm-2 lc-value">
                                                        <p id="status"></p>
                                                    </div>
                                                      <label class="col-sm-2 control-label">Date Submitted</label>
                                                    <div class="col-sm-2 lc-value">
                                                        <p id="dateSubmitted" class="lc-value"></p>
                                                    </div>
                                            </div>
                                        </div>

                                    </header>
                                    <div class="panel-body"> 
                                        <div class="form-horizontal" id="lcDetails">
                                            <!--
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Exporter ID </label>
                                                <div class="col-sm-10">
                                                    <p id="exporter_ID"></p>
                                                </div>
                                            </div>
                                            <div class="line line-dashed line-lg pull-in"></div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Exporter Bank Account</label>
                                                <div class="col-sm-10">
                                                    <p id="exporter_account_num"></p>
                                                </div>
                                                <input type="text" name ="tb_exporterAccountNum" data-required="true">
                                            </div>
                                            <div class="line line-dashed line-lg pull-in"></div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label" for="input-id-1">Goods Description</label>
                                                <div class="col-sm-10">
                                                    <p id="goods_description"></p>
                                                </div>
                                                <input type="text" name ="tb_goodsDescription" data-required="true">
                                            </div>
                                            <div class="line line-dashed line-lg pull-in"></div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label" for="input-id-1">Amount $</label>
                                                <div class="col-sm-10">
                                                    <p id="amount"></p>
                                                </div>
                                                <input type="number" name ="tb_amount" data-required="true">
                                            </div>
                                            <div class="line line-dashed line-lg pull-in"></div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Expiry Date</label>
                                                <div class="col-sm-10">
                                                    <p id="expiry_date"></p>
                                                </div>
                                                <input type="date" name ="tb_expiryDate" data-required="true">
                                            </div>
                                            <div class="line line-dashed line-lg pull-in"></div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">Additional Conditions</label>
                                                <div class="col-sm-10">
                                                    <p id="additional_conditions"></p>
                                                </div>
                                                <textarea name="Text1" cols="40" rows="5" name ="tb_additionalCondition" data-required="true"/>
                                            </div>
                                            <div class="line line-dashed line-lg pull-in"></div>
    
                                            <div class="form-group">
                                                <div class="col-sm-4 col-sm-offset-2">
    
                                                    <a href="lcDetails.html"><button type="submit" class="btn btn-primary">Cacncel</button></a>
                                                </div>
                                                <div class="col-sm-4 col-sm-offset-2">
                                                    <a href=""><button type="submit" class="btn btn-primary">Submit</button></a>
                                                </div>
                                            </div>
                                            -->
                                        </div>
                                    </div>


                                </section>


                            </section>
                            <!--End of Scrollable-->
                        </section>
                        <!--End of vbox-->
                    </section>
                    <!--End of Content-->

                </section>
                <!--End of hbox stretch -->
            </section>

        </section>
        <!--End of Vbox-->
        <script>
            $('#modifyLcBtn').click(function(){
            // generate all fields and submit motification

                var lc = new Object();
                for (var i in amendments) {
                    lc.i = $('#' + i).val;
                };

                $.ajax({
                url: 'localhost:9001/lc/modifyContract?refNum=' + refNum + '&contract=' + contractID,
                        type: 'POST',
                        dataType: 'json',
                        data: lc,
                        success: function (data, textStatus, xhr) {
                        //console.log(data);
                        window.location.replace("/SMUtBank_TradeFinance/importer/importer.html");
                        },
                        error: function (xhr, textStatus, errorThrown) {
                        //error msg
                        }

                });
            })
        </script>
        <script src="../assets/js/jquery.min.js"></script>
        <!-- Bootstrap -->
        <script src="../assets/js/bootstrap.js"></script>
        <!-- App -->
        <script src="../assets/js/app.js"></script>
        <script src="../assets/js/slimscroll/jquery.slimscroll.min.js"></script>
        <script src="../assets/js/charts/easypiechart/jquery.easy-pie-chart.js"></script>
        <script src="../assets/js/charts/sparkline/jquery.sparkline.min.js"></script>
        <script src="../assets/js/charts/flot/jquery.flot.min.js"></script>
        <script src="../assets/js/charts/flot/jquery.flot.tooltip.min.js"></script>
        <script src="../assets/js/charts/flot/jquery.flot.resize.js"></script>
        <script src="../assets/js/charts/flot/jquery.flot.grow.js"></script>
        <script src="../assets/js/charts/flot/demo.js"></script>

        <script src="../assets/js/calendar/bootstrap_calendar.js"></script>
        <script src="../assets/js/calendar/demo.js"></script>

        <script src="../assets/js/sortable/jquery.sortable.js"></script>

        <script src="../assets/js/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
        <script src="../assets/js/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
        <script src="../assets/js/jvectormap/demo.js"></script>
        <script src="../assets/js/app.plugin.js"></script>
        <!-- file input -->  
        <script src="../assets/js/file-input/bootstrap-filestyle.min.js"></script>
        <!-- select2 -->
        <script src="../assets/js/select2/select2.min.js"></script>   
    </body>

</html>
