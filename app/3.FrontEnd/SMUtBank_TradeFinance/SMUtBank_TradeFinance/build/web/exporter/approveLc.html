
<!DOCTYPE html>
<html lang="en" class="app">

    <head>
        <meta charset="utf-8" />
        <title>SMU tBank - Trade Finance Application</title>
        <meta name="description" content="app, web app, responsive, admin dashboard, admin, flat, flat ui, ui kit, off screen nav" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <link rel="stylesheet" href="../assets/css/bootstrap.css" type="text/css" />
        <link rel="stylesheet" href="../assets/css/animate.css" type="text/css" />
        <link rel="stylesheet" href="../assets/css/font-awesome.min.css" type="text/css" />
        <link rel="stylesheet" href="../assets/css/font.css" type="text/css" />
        <link rel="stylesheet" href="../assets/js/calendar/bootstrap_calendar.css" type="text/css" />
        <link rel="stylesheet" href="../assets/js/jvectormap/jquery-jvectormap-1.2.2.css" type="text/css" />
        <link rel="stylesheet" href="../assets/css/app.css" type="text/css" />
        <!--[if lt IE 9]>
        <script src="assets/js/ie/html5shiv.js"></script>
        <script src="assets/js/ie/respond.min.js"></script>
        <script src="assets/js/ie/excanvas.js"></script>
      <![endif]-->


        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
        <script src="../assets/js/getQueryVariable.js"></script>
        
        <script>
            $(function () {
                $("#header").load("../header.html");
                $("#nav-bar").load("navBar.html");
            });
        </script>

        <script>
                    /*function getQueryVariable(variable) {
                    var query = window.location.search.substring(1);
                            var vars = query.split("&");
                            for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split("=");
                            if (pair[0] == variable) {
                    return pair[1];
                    }
                    }
                    alert('Query Variable ' + variable + ' not found');
                    }*/

            var refNum = getQueryVariable("refNum");
            var LC_ID = "";
            var exporter_ID = "";
            var exporter_account_num = "";
            var goods_description = "";
            var amount = "";
            var expiry_date = "";
            var additional_conditions = "";
            if (refNum !== "") {
                var apiURL = 'http://smu.tbankonline.com/SMUtBank_API/Gateway';
                    // var testURL = 'http://smu.tbankonline.com/SMUtBank_API/Gateway?Header={"Header":{"PIN":"123456","OTP":"999999","serviceName":"getLetterOfCreditRefNumList","userID":"kinetic1"}}&ConsumerID=TF';
                    // var role = document.getElementByID("role").value;

                var headerObj = {
                    Header: {
                    serviceName: "getLetterOfCredit",
                            userID: "kinetic1",
                            PIN: "123456",
                            OTP: "999999"
                    }
                };
                var header = JSON.stringify(headerObj);
                var contentObj = {
                    Content: {
                    referenceNumber: refNum, // to change to variable refNum
                            mode: "BC"
                    }
                };
                var content = JSON.stringify(contentObj);
                if (true) {

                    var xmlHttp = new XMLHttpRequest(); //setup new http req
                    if (xmlHttp === null) {
                        alert("Browser does not support HTTP request."); //check for browser thingy
                    }

                    xmlHttp.open("POST", apiURL + "?Header=" + header + "&Content=" + content + "&ConsumerID=TF", true);
                    // xmlHttp.open("POST", testURL, true);
                    // console.log(apiURL+"?Header="+header+"&Content="+content+"&ConsumerID=TF");
                    xmlHttp.timeout = 5000;
                    // setup http event handlers
                    xmlHttp.onreadystatechange = function () {
                        if (xmlHttp.readyState === 4 && xmlHttp.status === 200) {
                            // console.log(xmlHttp.responseText);
                            responseObj = JSON.parse(xmlHttp.responseText);
                                // globalErrorID = responseObj.Content.ServiceRespHeader.GlobalErrorID;
                                //when the gateway is ready 
                                // console.log(JSON.stringify(responseObj.Content.ServiceResponse.LC_Details.LC_record.LC_ID) );
                            if (true) {
                                fields = responseObj.Content.ServiceResponse.LC_Details.LC_record;
                                var headerVariables = ["ref_num", "status", "creation_datetime"];
                                var refNum = fields[headerVariables[0]];
                                var status = fields[headerVariables[1]];
                                var dateSubmitted = fields[headerVariables[2]];
                                $('#refNum').html(refNum);
                                $('#status').html(status);
                                $('#dateSubmitted').html(dateSubmitted);
                                for (var i in fields) {
                                    var isCounted = false;
                                    for (var j in headerVariables) {

                                        if (i === headerVariables[j]) {
                                            isCounted = true;
                                        }
                                    }
                                    if (!isCounted) {
                                        var lcDetailsHTML = "<label class='col-lg-2 control-label lc-label'>" + i + "</label>";
                                        lcDetailsHTML += "<div class='col-lg-10 font-bold'><p id='" + i + "'></p>";
                                        lcDetailsHTML += fields[i] + "</div>";
                                        $("#lcDetails").append("<div class='form-group lc-form'>" + lcDetailsHTML + "</div>");
                                        $("#lcDetails").append("<div class='line line-dashed line-lg pull-in'></div>");
                                    }
                                }
                                var buttons = "<div class='form-group lc-form'>";
                                buttons += "<div class='col-sm-2 '><button type='submit' class='btn btn-primary' id='approveButton'>Approve</button></div>";
                                buttons += "<div class='col-sm-2 '><button type='submit' class='btn btn-primary' id='amendButton'>Request to amend</button></div>"
                                buttons += "</div>";
                                $("#lcButtons").append(buttons);
                                
                                $("#approveButton").click(function() {
                                        //retrieve ref num;

                                        //set status to "acknowledged"

                                        //update new status to bc

                                        //redirect to homepage
                                        window.location.replace("/SMUtBank_TradeFinance/exporter/exporter.html");

                                });
                                $("#amendButton").click(function() { 
                                         //retrieve ref num
                                         //redirect to amendlcdetails
                                         sessionStorage.setItem('refNum', JSON.stringify(refNum));
                                         window.location.replace("/SMUtBank_TradeFinance/exporter/amendLcDetails.html?refNum="+refNum);
                                });
                                
                            } else {

                            }

                        }
                    };
                    xmlHttp.ontimeout = function (e) {
                    alert("Timeout retrieving document type list.");
                            callback();
                    };
                    xmlHttp.send();
                }
            }
            function capitalizeFirstLetter(word) {
                return word.charAt(0).toUpperCase() + word.slice(1)
            }
            
            

        </script>


    </head>

    <body class="">
        <section class="vbox">
            <header class="bg-black dk header navbar navbar-fixed-top-xs" id="header">
            </header>
            <section>
                <section class="hbox stretch">
                    <!-- .aside -->
                    <aside class="bg-dark lter aside-md hidden-print hidden-xs" id="nav-bar">
                    </aside>
                    <!-- /.aside -->
                    <!--Content-->
                    <section id="content">
                        <section class="vbox">
                            <section class="scrollable">
                                <div class="wrapper-lg">
                                    <h2 class="m-b-xs font-bold m-t-none">Approve LC</h2>
                                </div>

                                <section class="panel panel-default">
                                    <header class="panel-heading font-bold">
                                        <div class="bs-example form-horizontal">
                                            <div class="form-group lc-form">
                                                <h4 class="col-sm-12 font-bold">LC Details</h4>
                                            </div>
                                        </div>
                                    </header>
                                    <header class="panel-heading font-bold">
                                        <div class="bs-example form-horizontal">
                                            <div class="form-group lc-form">
                                                <label class="col-sm-2 control-label lc-label">Ref Num </label>
                                                <div class="col-sm-2 lc-value">
                                                    <p id="refNum"></p>
                                                </div>
                                                <label class="col-sm-2 control-label">Status </label>
                                                <div class="col-sm-2 lc-value">
                                                    <p id="status"></p>
                                                </div>
                                                <label class="col-sm-2 control-label">Date Submitted</label>
                                                <div class="col-sm-2 lc-value">
                                                    <p id="dateSubmitted" class="lc-value"></p>
                                                </div>
                                            </div>
                                        </div>

                                    </header>
                                    <div class="panel-body">
                                        <div class="bs-example form-horizontal" id="lcDetails">

                                        </div>
                                        <div class="bs-example form-horizontal" id="lcButtons">

                                        </div>
                                    </div>

                                </section>


                            </section>
                            <!--End of Scrollable-->
                        </section>
                        <!--End of vbox-->

                    </section>
                    <!--End of Content-->

                </section>
                <!--End of hbox stretch -->
            </section>

        </section>
        <!--End of Vbox-->

        <script src="../assets/js/jquery.min.js"></script>
        <!-- Bootstrap -->
        <script src="../assets/js/bootstrap.js"></script>
        <!-- App -->
        <script src="../assets/js/app.js"></script>
        <script src="../assets/js/slimscroll/jquery.slimscroll.min.js"></script>
        <!-- parsley -->
        <script src="../assets/js/parsley/parsley.min.js"></script>
        <script src="../assets/js/parsley/parsley.extend.js"></script>
        <script src="../assets/js/app.plugin.js"></script>
        <script src="../assets/js/app.plugin.js"></script>

        <script>
            
           /* $(document).ready(function() {
                var refNum = getQueryVariable("refNum");
                $("#approveButton").click(function() {
                    //retrieve ref num;
                    
                    //set status to "acknowledged"

                    //upload status change to bc

                    //redirect to homepage
                    window.location = "/SMUtBank_TradeFinance/exporter/exporter.html";

                });
                 $("#amendButton").click(function() { 
                     //retrieve ref num
                     //redirect to amendlcdetails
                     window.location = "/SMUtBank_TradeFinance/exporter/amendLcDetails.html?refNum="+refNum;
                 });
            });*/
        </script>

    </body>

</html>
