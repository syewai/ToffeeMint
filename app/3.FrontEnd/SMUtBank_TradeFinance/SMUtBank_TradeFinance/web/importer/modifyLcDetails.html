<!DOCTYPE html>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
<script>
    function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        if (pair[0] == variable) {
          return pair[1];
        }
      } 
      alert('Query Variable ' + variable + ' not found');
    }

    var refNum = getQueryVariable("refNum");
    //call get contract to get original contract submitted by importer
    var getContractUrl = "localhost:9001/lc/getContract?refNum="+refNum;
    
    // call get amendment request to get amended lc done by exporter
    var getAmendmentsUrl = "localhost:9001/lc/getAmendments?refNum="+refNum;
    
    var originalContract = null;
    var amendments = null;
    $.get(getContractUrl, function(data) {
      original = data;
    });

    $.get(getAmendmentsUrl, function(data) {
      amendments = data;
    });
    var contractID = amendments.LC_ID;
    
    for (var i in amendments) {
       var lcDetailsHTML = "<label class='col-sm-2 control-label'>"+i+"</label>";
        lcDetailsHTML += "<div class='col-sm-10'><p id='"+i+"'></p>";
        lcDetailsHTML += "</div><input type='text' name ="+i+" data-required='true' placeholder='"+amendments[i]+"'>";
         //compare 2 json objects, if any of the values is different, highlight the different values 
        if (amendments[i] !== originalContract[i]) {
           var getInputElement = lcDetailsHTML.getElementsByTagName("input");
           var color = $(getInputElement).css( "background-color", "yellow" );     
        }   
       $( "#lcDetails" ).append( "<div class='form-group'>"+lcDetailsHTML+"</div>" ); 
       $( "#lcDetails" ).append( "<div class='line line-dashed line-lg pull-in'></div>" );
    }
    
    var buttons = "<div class='form-group'><div class='col-sm-4 col-sm-offset-2'><a href='importer.html'><button type='submit' class='btn btn-primary'>Back</button></a></div>";
        buttons += "<div class='col-sm-4 col-sm-offset-2'><button id='modifyLcBtn' type='submit' class='btn btn-primary'>Submit</button></div></div>";

    $( "#lcDetails" ).append(buttons);
    
</script>
<section class="vbox">
    <section class="scrollable">
        <div class="wrapper-lg">
            <h2 class="m-b-xs font-bold m-t-none">LC Modification</h2>
        </div>

        <section class="panel panel-default">
            <header class="panel-heading font-bold">

            </header>
            <div class="panel-body"> 
                <div class="form-horizontal" id="lcDetails">
                    <!--
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Exporter ID </label>
                        <div class="col-sm-10">
                            <p id="exporter_ID"></p>
                        </div>
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Exporter Bank Account</label>
                        <div class="col-sm-10">
                            <p id="exporter_account_num"></p>
                        </div>
                        <input type="text" name ="tb_exporterAccountNum" data-required="true">
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-id-1">Goods Description</label>
                        <div class="col-sm-10">
                            <p id="goods_description"></p>
                        </div>
                        <input type="text" name ="tb_goodsDescription" data-required="true">
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-id-1">Amount $</label>
                        <div class="col-sm-10">
                            <p id="amount"></p>
                        </div>
                        <input type="number" name ="tb_amount" data-required="true">
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Expiry Date</label>
                        <div class="col-sm-10">
                            <p id="expiry_date"></p>
                        </div>
                        <input type="date" name ="tb_expiryDate" data-required="true">
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Additional Conditions</label>
                        <div class="col-sm-10">
                            <p id="additional_conditions"></p>
                        </div>
                        <textarea name="Text1" cols="40" rows="5" name ="tb_additionalCondition" data-required="true"/>
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                   
                    <div class="form-group">
                        <div class="col-sm-4 col-sm-offset-2">
                            
                            <a href="lcDetails.html"><button type="submit" class="btn btn-primary">Cacncel</button></a>
                        </div>
                        <div class="col-sm-4 col-sm-offset-2">
                            <a href=""><button type="submit" class="btn btn-primary">Submit</button></a>
                        </div>
                    </div>
                  -->
                </div>
            </div>


        </section>


    </section>
    <!--End of Scrollable-->
</section>
<!--End of vbox-->

<script>
    $('#modifyLcBtn').click(function(){
    // generate all fields and submit motification
    
    var lc = new Object();
    for (var i in amendments) {
        lc.i = $('#'+i).val;   
    }
    
    $.ajax({
        url: 'localhost:9001/lc/modifyContract?refNum='+refNum+'&contract='+contractID,
        type: 'POST',
        dataType: 'json',
        data: lc,
        success: function (data, textStatus, xhr) {
            //console.log(data);
            window.location.replace("/SMUtBank_TradeFinance/importer/importer.html"); 
        },
        error: function (xhr, textStatus, errorThrown) {
            //error msg
        }
    
    });
</script>