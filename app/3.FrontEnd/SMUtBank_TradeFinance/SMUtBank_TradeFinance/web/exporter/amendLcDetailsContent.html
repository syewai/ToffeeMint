<!DOCTYPE html>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
<!--<script src="../assets/js/getQueryVairable.js"></script>-->
<script>
    function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        if (pair[0] == variable) {
          return pair[1];
        }
      } 
      alert('Query Variable ' + variable + ' not found');
}

    var temp = sessionStorage.getItem('refNum');
    var viewName = $.parseJSON(temp);

    console.log(viewName);
    console.log(viewName.refNum);
    var refNum = getQueryVariable("refNum");
    var LC_ID = "";
    var exporter_ID = "";
    var exporter_account_num = "";

    var goods_description = "";
    var amount = "";
    var expiry_date = "";
    var additional_conditions = "";

    if (refNum !== "") {
        var apiURL = 'http://smu.tbankonline.com/SMUtBank_API/Gateway';
        // var testURL = 'http://smu.tbankonline.com/SMUtBank_API/Gateway?Header={"Header":{"PIN":"123456","OTP":"999999","serviceName":"getLetterOfCreditRefNumList","userID":"kinetic1"}}&ConsumerID=TF';
        // var role = document.getElementByID("role").value;

        var headerObj = {
            Header: {
                serviceName: "getLetterOfCredit",
                userID: "kinetic1",
                PIN: "123456",
                OTP: "999999"
            }
        };
        var header = JSON.stringify(headerObj);

        var contentObj = {
            Content: {
                referenceNumber: refNum, // to change to variable refNum
                mode: "BC"
            }
        };
        var content = JSON.stringify(contentObj);

        if (true) {

            var xmlHttp = new XMLHttpRequest();              //setup new http req
            if (xmlHttp === null) {
                alert("Browser does not support HTTP request."); //check for browser thingy
            }

            xmlHttp.open("POST", apiURL + "?Header=" + header + "&Content=" + content + "&ConsumerID=TF", true);
            // xmlHttp.open("POST", testURL, true);
            // console.log(apiURL+"?Header="+header+"&Content="+content+"&ConsumerID=TF");
            xmlHttp.timeout = 5000;

            // setup http event handlers
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState === 4 && xmlHttp.status === 200) {
                    // console.log(xmlHttp.responseText);
                    responseObj = JSON.parse(xmlHttp.responseText);
                    // globalErrorID = responseObj.Content.ServiceRespHeader.GlobalErrorID;
                    //when the gateway is ready 
                    // console.log(JSON.stringify(responseObj.Content.ServiceResponse.LC_Details.LC_record.LC_ID) );
                    if (true) {
                        fields = responseObj.Content.ServiceResponse.LC_Details.LC_record;
                        var headerVariables = ["ref_num","status","creation_datetime"];
                        var refNum = fields[headerVariables[0]];
                        var status = fields[headerVariables[1]];
                        var dateSubmitted = fields[headerVariables[2]];
                        $('#refNum').html(refNum);
                        $('#status').html(status);
                        $('#dateSubmitted').html(dateSubmitted);
                        for (var i in fields) {
                            
                            var isCounted = false;
                            for (var j in headerVariables){
                                
                                if (i === headerVariables[j]){
                                    isCounted = true;
                                }
                            }
                            if(!isCounted){
                                var lcDetailsHTML = "<label class='col-lg-2 control-label lc-label'>" + i + "</label>";
                                lcDetailsHTML += "<div class='col-lg-10 font-bold'><p id='" + i + "'></p>";
                                lcDetailsHTML += "</div><input id='input' type='text' name ="+i+" data-required='true' placeholder='"+fields[i]+"'>"";

                                $("#lcDetails").append("<div class='form-group lc-form'>" + lcDetailsHTML + "</div>");
                                $("#lcDetails").append("<div class='line line-dashed line-lg pull-in'></div>");
                                
                            }
                        }
                        var buttons = "<div class='form-group'><div class='col-sm-4 col-sm-offset-2'><a href='importer.html'><button type='submit' class='btn btn-primary'>Home</button></a></div>";
                        buttons += "</div>";

                        $("#lcDetails").append(buttons);
                        /*exporter_ID = responseObj.Content.ServiceResponse.LC_Details.LC_record.exporter_ID;
                         exporter_account_num = responseObj.Content.ServiceResponse.LC_Details.LC_record.exporter_account_num;
                         goods_description = responseObj.Content.ServiceResponse.LC_Details.LC_record.goods_description;
                         amount = responseObj.Content.ServiceResponse.LC_Details.LC_record.amount;
                         expiry_date = responseObj.Content.ServiceResponse.LC_Details.LC_record.expiry_date;
                         additional_conditions = responseObj.Content.ServiceResponse.LC_Details.LC_record.additional_conditions;
                         
                         $('#exporter_ID').html(exporter_ID);
                         $('#exporter_account_num').html(exporter_account_num);
                         $('#goods_description').html(goods_description);
                         $('#expiry_date').html(expiry_date);
                         $('#additional_conditions').html(additional_conditions);
                         $('#amount').html(amount);*/
                    } else {

                    }

                }
            };
            xmlHttp.ontimeout = function (e) {
                alert("Timeout retrieving document type list.");
                callback();
            };

            xmlHttp.send();

        }
    }
    function capitalizeFirstLetter(word) {
        return word.charAt(0).toUpperCase() + word.slice(1)
    }

</script>
<section class="vbox">
    <section class="scrollable">
        <div class="wrapper-lg">
            <h2 class="m-b-xs font-bold m-t-none">Amend LC</h2>
        </div>

        <section class="panel panel-default">
            <header class="panel-heading font-bold">
                <div class="bs-example form-horizontal">
                    <div class="form-group lc-form">
                            <label class="col-sm-2 control-label lc-label">Ref Num </label>
                            <div class="col-sm-2 lc-value">
                                <p id="refNum"></p>
                            </div>
                             <label class="col-sm-2 control-label">Status </label>
                            <div class="col-sm-2 lc-value">
                                <p id="status"></p>
                            </div>
                              <label class="col-sm-2 control-label">Date Submitted</label>
                            <div class="col-sm-2 lc-value">
                                <p id="dateSubmitted" class="lc-value"></p>
                            </div>
                    </div>
                </div>

            </header>
            <div class="panel-body">
                <div class="bs-example form-horizontal" id="lcDetails">
                    <!--<div class="form-group">
                        <label class="col-sm-2 control-label">Exporter ID </label>
                        <div class="col-sm-10">
                            <p id="exporter_ID"></p>
                        </div>
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Exporter Bank Account</label>
                        <div class="col-sm-10">
                            <p id="exporter_account_num"></p>
                        </div>
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-id-1">Goods Description</label>
                        <div class="col-sm-10">
                            <p id="goods_description"></p>
                        </div>
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="input-id-1">Amount</label>
                        <div class="col-sm-10">
                            <p id="amount"></p>
                        </div>
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Expiry Date</label>
                        <div class="col-sm-10">
                            <p id="expiry_date"></p>
                        </div>
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Additional Conditions</label>
                        <div class="col-sm-10">
                            <p id="additional_conditions"></p>
                        </div>
                    </div>
                    <div class="line line-dashed line-lg pull-in"></div>
                    -->
                    <!--<div class="form-group">
                        <div class="col-sm-4 col-sm-offset-2">
                            
                            <a href="importer.html"><button type="submit" class="btn btn-primary">Back</button></a> 
                        </div>
                    </div>
                </div>-->
                </div>
            </div>

        </section>


    </section>
    <!--End of Scrollable-->
</section>
<!--End of vbox-->

